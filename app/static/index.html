<!DOCTYPE html>
<html>
<head>
    <title>DevOps To-Do App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<div class="container">
    <h1>ðŸš€ DevOps Tasks Test</h1>
    <div class="input-group">
        <input type="text" id="todoInput" placeholder="New task (e.g., Fix CI Pipeline)...">
        <button class="add-btn" onclick="addTodo()">Add</button>
    </div>
    <ul id="todoList"></ul>
</div>

<script>
    const API_URL = '/todos';

    // 1. Fetch and Display Todos
    async function fetchTodos() {
        const response = await fetch(API_URL);
        const todos = await response.json();
        const list = document.getElementById('todoList');
        list.innerHTML = ''; // Clear current list

        todos.forEach(todo => {
            const li = document.createElement('li');
            li.innerHTML = `
                <div class="task-content">
                    <input type="checkbox" 
                           ${todo.completed ? 'checked' : ''} 
                           onchange="toggleTodo(${todo.id}, this.checked)">
                    <span class="${todo.completed ? 'completed' : ''}">${todo.title}</span>
                </div>
                <button class="delete-btn" onclick="deleteTodo(${todo.id})">Delete</button>
            `;
            list.appendChild(li);
        });
    }

    // 2. Add New Todo
    async function addTodo() {
        const input = document.getElementById('todoInput');
        if (!input.value) return;
        
        await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title: input.value })
        });
        input.value = '';
        fetchTodos();
    }

    // 3. Toggle Complete (PUT Request)
    async function toggleTodo(id, isChecked) {
        await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ completed: isChecked })
        });
        fetchTodos(); // Refresh to update strikethrough style
    }

    // 4. Delete Todo (DELETE Request)
    async function deleteTodo(id) {
        if(!confirm("Are you sure?")) return;
        await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        fetchTodos();
    }

    // Load on start
    fetchTodos();
</script>

</body>
</html>